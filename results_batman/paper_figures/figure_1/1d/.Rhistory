source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
tcr_data <- tcr_data[tcr_data$index_peptide %in% index_peptide_list,]
9*172
table(tcr_data$index_peptide)
mutation_location <- paste0(tcr_data$index_peptide) != paste0(tcr_data$peptide)
a<- paste0(tcr_data$index_peptide)
a<- paste0(tcr_data$index_peptide,collapse='')
mutation_location <- paste0(tcr_data$index_peptide,collapse='') !=
paste0(tcr_data$peptide,collapse='')
mutation_location <- paste0(tcr_data$index_peptide,collapse=',') !=
paste0(tcr_data$peptide,collapse=',')
mutation_location <- strsplit(paste0(tcr_data$index_peptide,collapse='')) !=
strsplit(paste0(tcr_data$peptide,collapse=''))
mutation_location <- strsplit(paste0(tcr_data$index_peptide,collapse=''),'') !=
strsplit(paste0(tcr_data$peptide,collapse=''),'')
a <- strsplit(paste0(tcr_data$index_peptide,collapse=''),'')
a <- c(paste0(tcr_data$index_peptide,collapse=''))
mutation_location <- c(paste0(tcr_data$index_peptide,collapse='')) !=
c(paste0(tcr_data$peptide,collapse=''))
a <- c(strsplit(paste0(tcr_data$index_peptide,collapse=''),''))
a <- unlist(strsplit(paste0(tcr_data$index_peptide,collapse=''),''))
mutation_location <- unlist(strsplit(paste0(tcr_data$index_peptide,collapse=''),'')) !=
unlist(strsplit(paste0(tcr_data$peptide,collapse=''),''))
mutation_location <- matrix(mutation_location, ncol = 9, byrow = TRUE)
View(mutation_location)
View(mutation_location)
a<- matrix(c(1:9),nrow=10)
a<- tile(c(1:9),nrow=10)
a<- repmat(c(1:9),nrow=10)
a<- rep(c(1:9),nrow=10)
a<- rep(c(1:9),10)
a<- rep(c(1:9),c(1,10))
a<- rep(c(1:9),length(mutation_location)/9)
# First flatten WT and mutated seqs, then do elementwise comparison
mutation_location <- unlist(strsplit(paste0(tcr_data$index_peptide,collapse=''),'')) !=
unlist(strsplit(paste0(tcr_data$peptide,collapse=''),''))
# Multiply by digits array to assign location and reshape
mutation_location <- matrix(mutation_location*rep(c(1:9),
length(mutation_location)/9),
ncol = 9, byrow = TRUE)
View(mutation_location)
View(mutation_location)
mutation_location <- colsum(mutation_location)
mutation_location <- colSums(mutation_location)
# First flatten WT and mutated seqs, then do elementwise comparison
mutation_location <- unlist(strsplit(paste0(tcr_data$index_peptide,collapse=''),'')) !=
unlist(strsplit(paste0(tcr_data$peptide,collapse=''),''))
# Multiply by digits array to assign location and reshape
mutation_location <- matrix(mutation_location*rep(c(1:9),
length(mutation_location)/9),
ncol = 9, byrow = TRUE)
mutation_location <- rowSums(mutation_location)
pmhc_data <- read_csv(paste0('../../../tcr_epitope_datasets/netmhcpan_predictions',
'/netMHCpan_formatted_predictions.csv'))
View(pmhc_data)
View(pmhc_data)
pmhc_data <- pmhc_data[pmhc_data$MHC=='HLA-A*0201',]
View(pmhc_data)
View(pmhc_data)
View(pmhc_data)
View(pmhc_data)
# Load NetMHCPan predictions
pmhc_data <- read_csv(paste0('../../../tcr_epitope_datasets/netmhcpan_predictions',
'/netMHCpan_formatted_predictions.csv'))
# subset by HLA-A*02:01 and st peptide as index
pmhc_data <- pmhc_data[pmhc_data$MHC=='HLA-A*0201',].set_index('Peptide')
pmhc_data <- pmhc_data[pmhc_data$MHC=='HLA-A*0201',]
pmhc_data <- pmhc_data.set_index('Peptide')
rownames(pmhc_data) <- pmhc_data$Peptide
# Load NetMHCPan predictions
pmhc_data <- read_csv(paste0('../../../tcr_epitope_datasets/netmhcpan_predictions',
'/netMHCpan_formatted_predictions.csv'),
index_col="Peptide")
pmhc_data <- read_csv(paste0('../../../tcr_epitope_datasets/netmhcpan_predictions',
'/netMHCpan_formatted_predictions.csv'),
row.names="Peptide")
View(pmhc_data)
View(pmhc_data)
pmhc_data <- read.csv(paste0('../../../tcr_epitope_datasets/netmhcpan_predictions',
'/netMHCpan_formatted_predictions.csv'),
row.names="Peptide")
pmhc_data <- read.csv(paste0('../../../tcr_epitope_datasets/netmhcpan_predictions',
'/netMHCpan_formatted_predictions.csv'))
pmhc_data <- pmhc_data[!duplicated(pmhc_data),]
# Load NetMHCPan predictions
pmhc_data <- read.csv(paste0('../../../tcr_epitope_datasets/netmhcpan_predictions',
'/netMHCpan_formatted_predictions.csv'))
# subset by HLA-A*02:01
pmhc_data <- pmhc_data[pmhc_data$MHC=='HLA-A*0201',]
# Set Peptides as row names
rownames(pmhc_data) <- pmhc_data$Peptide
View(pmhc_data)
View(pmhc_data)
unique(tcr_data$tcr)
View(tcr_data)
View(tcr_data)
max(a)
# Assign TCR activation category
tcr_data$tcr_activation <- 2 #Initialize
tcr_names <- unique(tcr_data$tcr) # List all TCRs
# Loop over TCRs
for (tcr in tcr_names) {
# Extract peptides and their activities for a particular TCR
peptide_list <- tcr_data$peptide[TCR_data$tcr==tcr]
peptide_activity <- tcr_data$peptide_activity[tcr_data$tcr_name==tcr]
# Normalize peptide activities to the maximum activity
peptide_activity <- peptide_activity/max(peptide_activity)
# Indicate TCR activation categories
#Initialize with all weak binders
activation <- matrix(2,nrow=length(peptide_list),ncol=1)
activation[peptide_activity<0.1] <- 1 #Non-binder
activation[peptide_activity>=0.5] <- 3 #strong-binder
tcr_data$tcr_activation[tcr_data$tcr==tcr] <- as.integer(activation)
}
# Loop over TCRs
for (tcr in tcr_names) {
# Extract peptides and their activities for a particular TCR
peptide_list <- tcr_data$peptide[tcr_data$tcr==tcr]
peptide_activity <- tcr_data$peptide_activity[tcr_data$tcr_name==tcr]
# Normalize peptide activities to the maximum activity
peptide_activity <- peptide_activity/max(peptide_activity)
# Indicate TCR activation categories
#Initialize with all weak binders
activation <- matrix(2,nrow=length(peptide_list),ncol=1)
activation[peptide_activity<0.1] <- 1 #Non-binder
activation[peptide_activity>=0.5] <- 3 #strong-binder
tcr_data$tcr_activation[tcr_data$tcr==tcr] <- as.integer(activation)
}
warnings()
for (tcr in tcr_names) {
# Extract peptides and their activities for a particular TCR
peptide_list <- tcr_data$peptide[tcr_data$tcr==tcr]
peptide_activity <- tcr_data$peptide_activity[tcr_data$tcr==tcr]
# Normalize peptide activities to the maximum activity
peptide_activity <- peptide_activity/max(peptide_activity)
# Indicate TCR activation categories
#Initialize with all weak binders
activation <- matrix(2,nrow=length(peptide_list),ncol=1)
activation[peptide_activity<0.1] <- 1 #Non-binder
activation[peptide_activity>=0.5] <- 3 #strong-binder
tcr_data$tcr_activation[tcr_data$tcr==tcr] <- as.integer(activation)
}
View(tcr_data)
View(tcr_data)
View(tcr_data)
View(tcr_data)
View(tcr_data)
View(tcr_data)
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
View(tcr_data)
View(tcr_data)
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
tcr_data$BindLevel <- pmhc_data[tcr_data$peptide,'BindLevel']
View(tcr_data)
View(tcr_data)
View(pmhc_data)
View(pmhc_data)
pmhc_data$BindLevel[is.na(pmhc_data$BindLevel)] <- "NB"
View(pmhc_data)
View(pmhc_data)
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
View(tcr_data)
View(tcr_data)
warnings
warnings()
rownames(pmhc_data) <- pmhc_data$Peptide
pmhc_data$BindLevel[is.na(pmhc_data$BindLevel)] <- "NB"
View(pmhc_data)
View(pmhc_data)
pmhc_data$BindLevel[is.empty(pmhc_data$BindLevel)] <- "NB"
View(pmhc_data)
View(pmhc_data)
table(pmhc_data$BindLevel)
pmhc_data$BindLevel[pmhc_data$BindLevel==""] <- "NB"
View(pmhc_data)
View(pmhc_data)
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
View(tcr_data)
View(tcr_data)
counts <- tcr_data %>% dplyr::count(BindLevel, tcr_activation)
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
warnings()
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
View(tcr_data)
View(tcr_data)
View(tcr_data)
View(tcr_data)
View(tcr_data)
View(tcr_data)
tcr_data <- read_excel(paste0('../../../tcr_epitope_datasets/mutational_scan_datasets',
'/TCR_pMHCI_mutational_scan_database.xlsx')) %>%
select(tcr,index_peptide,mhc,peptide,peptide_activity)
warnings()
View(tcr_data)
View(tcr_data)
# Get TCR activation data
tcr_data <- read_excel(paste0('../../../tcr_epitope_datasets/mutational_scan_datasets',
'/TCR_pMHCI_mutational_scan_database.xlsx'))
View(tcr_data)
View(tcr_data)
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
source("~/batman_resub/paper_figures/figure_1/1d/plot_tcr_activation_vs_pmhc_binding_for_1d.R")
